{"version":3,"sources":["../../scripts/settingsControl.js"],"names":["document","body","classList","contains","sendData","data","url","isAsync","successCallback","errorCallback","xhr","XMLHttpRequest","open","setRequestHeader","onerror","onload","status","send","addButtonWaiter","element","disabled","add","removeButtonWaiter","undefined","remove","openButtons","querySelectorAll","changeButtons","button","addEventListener","event","preventDefault","section","nextElementSibling","style","maxHeight","String","calculateHeight","inputs","parentElement","children","slice","length","values","map","value","notify","type","test","every","endCallback","bind","newEmail","password","confirm","newPassword","link","window","location","origin","JSON","stringify","reduce","init","cur","computedStyle","getComputedStyle","parseInt","height","marginTop","marginBottom","borderTopWidth","borderBottomWidth","paddingBottom","paddingTop"],"mappings":"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","file":"settingsControl.js","sourcesContent":["if (document.body.classList.contains('settings-body')) {\r\n    let openButtons = document.querySelectorAll('.main-settings__section-opener');\r\n    let changeButtons = document.querySelectorAll('.main-settings__change-button');\r\n\r\n    for (let button of openButtons) {\r\n        button.addEventListener('click', function (event) {\r\n            event.preventDefault();\r\n            let section = this.nextElementSibling;\r\n            // Вычисление высоты для раскрывающегося списка\r\n\r\n            if (!section.style.maxHeight) {\r\n                section.style.maxHeight = String(calculateHeight(section)) + 'px';\r\n            } else {\r\n                section.style.maxHeight = '';\r\n            }\r\n        })\r\n    }\r\n\r\n    for (let button of changeButtons) {\r\n        button.addEventListener('click', function (event) {\r\n            event.preventDefault();\r\n            let inputs = [...this.parentElement.children].slice(0, this.parentElement.children.length - 1);\r\n\r\n            let values = inputs.map(({value}) => value);\r\n\r\n            if (values[1] && values[2] && values[1] !== values[2]) {\r\n                notify(true, 'Введенные пароли не совпадают.', 'warning');\r\n\r\n                return;\r\n            }\r\n\r\n            if (inputs[0] && inputs[0].type === 'email' && !/^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,5})+$/.test(inputs[0].value)) {\r\n                notify(true, 'Введен некорректный email.', 'warning');\r\n\r\n                return;\r\n            }\r\n\r\n            if (values.every(value => value)) {\r\n                addButtonWaiter(this);\r\n                let endCallback = function () {\r\n                    removeButtonWaiter(this);\r\n                    notify(true, 'Инструкция по смене данных отправлена на вашу почту.', 'success');\r\n                }.bind(this);\r\n                let errorCallback = function () {\r\n                    removeButtonWaiter(this);\r\n                    notify(true, 'При смене данных возникла ошибка. Попробуйте еще раз.', 'failure');\r\n                }.bind(this);\r\n\r\n                let data = inputs[0].type === 'email' ? {\r\n                    newEmail: values[0],\r\n                    password: values[1],\r\n                    confirm: values[2]\r\n                } : {\r\n                    newPassword: values[0],\r\n                    password: values[1],\r\n                    confirm: values[2]\r\n                };\r\n\r\n                let link =  window.location.origin + (inputs[0].type === 'email' ? 'changeEmail' : 'changePass');\r\n                sendData(JSON.stringify(data), link, true, endCallback, errorCallback);\r\n            } else {\r\n                notify(true, 'Пожалуйста, заполните все поля.', 'warning');\r\n            }\r\n        })\r\n    }\r\n\r\n    function sendData(data, url, isAsync, successCallback, errorCallback) {\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.open('POST', url, isAsync);\r\n        xhr.setRequestHeader('Content-Type', 'application/json');\r\n        xhr.onerror = errorCallback;\r\n        xhr.onload = function () {\r\n            if (xhr.status === 200) {\r\n                successCallback();\r\n            } else {\r\n                errorCallback();\r\n            }\r\n        };\r\n        xhr.send(data);\r\n    }\r\n\r\n    function addButtonWaiter(element) {\r\n        element.disabled = true;\r\n        element.classList.add('btn-loading');\r\n    }\r\n\r\n    function removeButtonWaiter(element) {\r\n        element.disabled = undefined;\r\n        element.classList.remove('btn-loading');\r\n    }\r\n}\r\n\r\nfunction calculateHeight(element) {\r\n    return [...element.children].reduce((init, cur) => {\r\n        let computedStyle = window.getComputedStyle(cur);\r\n        return init + parseInt(computedStyle.height) +\r\n            parseInt(computedStyle.marginTop) +\r\n            parseInt(computedStyle.marginBottom) +\r\n            parseInt(computedStyle.borderTopWidth) +\r\n            parseInt(computedStyle.borderBottomWidth) +\r\n            parseInt(computedStyle.paddingBottom) +\r\n            parseInt(computedStyle.paddingTop);\r\n    }, 0);\r\n}"]}